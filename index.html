<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>♡キャラ学生証ファクトリー♡</title>
  <meta name="description" content="みりんてゃみたいな超エモ学生証が作れる！方眼紙背景＋情報ギッシリ＋ひとこと付き♡">
  <meta property="og:title" content="♡キャラ学生証ファクトリー♡">
  <meta property="og:description" content="推しもオリキャラも！あのエモい学生証が作れるよ〜">
  <link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root {
      --main: #ff69b4;
      --text: #6B4F3A;
      --bg: #fffaf0;
      --grid: rgba(255,182,193,0.12);
      --photo-bg: #e6f2ff;
      --border: #d8c4a8;
    }
    body {
      margin: 0;
      font-family: 'Kiwi Maru', sans-serif;
      background: linear-gradient(#fff0f8, #ffe4f0);
      padding: 20px 0;
      min-height: 100vh;
    }
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: url('https://www.transparenttextures.com/patterns/graphy.png');
      opacity: 0.3;
      pointer-events: none;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 24px;
      box-shadow: 0 15px 40px rgba(255,105,180,0.25);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(90deg, #ffb3d9, #ff69b4);
      color: white;
      text-align: center;
      padding: 30px;
      font-size: 30px;
      font-weight: bold;
    }
    .main {
      padding: 40px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 50px;
    }
    @media (max-width: 900px) {
      .main { grid-template-columns: 1fr; gap: 30px; }
    }
    .form-area {
      background: #fffafa;
      padding: 30px;
      border-radius: 20px;
      border: 3px dashed #ffd1dc;
    }
    label {
      display: block;
      margin: 16px 0 6px;
      font-weight: bold;
      color: #b36c84;
    }
    input, textarea, select {
      width: 100%;
      padding: 12px;
      border: 2px solid #ffd1dc;
      border-radius: 10px;
      font-size: 16px;
      box-sizing: border-box;
    }
    input:focus, textarea:focus { outline: none; border-color: var(--main); }
    button {
      background: var(--main);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 30px;
      font-weight: bold;
      cursor: pointer;
      margin: 10px 5px 0 0;
    }

    /* 学生証本体 */
    #card {
      width: 100%;
      background: var(--bg);
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      position: relative;
      color: var(--text);
      font-size: 15px;
      line-height: 1.6;
    }
    .card-header {
      text-align: center;
      margin-bottom: 20px;
      position: relative;
    }
    .school-title {
      font-size: 26px;
      font-weight: bold;
      color: var(--text);
    }
    .logo-img {
      position: absolute;
      top: -10px;
      right: 0;
      width: 60px;
      height: 60px;
      object-fit: contain;
    }
    .card-body {
      display: grid;
      grid-template-columns: 180px 1fr;
      gap: 25px;
      align-items: start;
    }
    .photo-frame {
      width: 180px;
      height: 180px;
      background: var(--photo-bg);
      border: 8px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .photo-frame img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .info-basic { margin-bottom: 20px; }
    .info-basic div { margin: 8px 0; }
    .name { font-size: 28px; font-weight: bold; color: #d14a8a; }
    .extra-info div { margin: 6px 0; }
    .oneline {
      margin-top: 20px;
      padding: 16px;
      background: rgba(255,255,255,0.7);
      border-radius: 12px;
      font-style: italic;
      text-align: center;
      border: 2px dashed #ffd1dc;
    }
    .footer {
      text-align: center;
      padding: 30px;
      background: #fff0f5;
    }
    .footer a { color: var(--main); font-weight: bold; text-decoration: none; }
  </style>
</head>
<body>

<div class="container">
  <div class="header">♡ キャラ学生証ファクトリー ♡</div>
  
  <div class="main">
    <div class="form-area">
      <label>学校名</label>
      <input type="text" id="school" value="とりの丘学園">

      <label>名前（ふりがなも可）</label>
      <input type="text" id="name" value="萩枝 美琳（はぎえだ みりん）">

      <label>学年・クラス（任意）</label>
      <input type="text" id="grade" placeholder="例：1年A組、留年中、卒業生など">

      <label>学籍番号／ID（任意）</label>
      <input type="text" id="studentId" placeholder="例：000322、666など">

      <label>性別</label>
      <input type="text" id="gender" value="女">

      <label>誕生日</label>
      <input type="text" id="birthday" value="3月20日">

      <label>血液型</label>
      <input type="text" id="blood" value="A型">

      <label>MBTI</label>
      <input type="text" id="mbti" value="ENFP">

      <label>出身地</label>
      <input type="text" id="from" value="お菓子の国">

      <label>性格</label>
      <input type="text" id="personality" value="甘えん坊でいたずら好き">

      <label>モチーフ</label>
      <input type="text" id="motif" value="黒猫">

      <label>好きなもの</label>
      <input type="text" id="like" value="甘いお菓子・お昼寝・かまってくれる人">

      <label>苦手なもの</label>
      <input type="text" id="hate" value="寂しさ・早起き">

      <label>ひとこと</label>
      <textarea id="oneline" rows="2">えへへ♡かまってくれなきゃイタズラしちゃうぞ〜</textarea>

      <label>顔写真アップロード</label>
      <input type="file" id="photo" accept="image/*">

      <label>右上ロゴ画像（任意）</label>
      <input type="file" id="logo" accept="image/*">

      <div style="margin-top:25px;">
        <button onclick="update()">プレビュー更新</button>
        <button onclick="save()">画像保存♡</button>
        <button onclick="share('line')">LINEでシェア</button>
        <button onclick="share('x')">Xでシェア</button>
      </div>
    </div>

    <div id="card">
      <div class="card-header">
        <div class="school-title" id="prevSchool">とりの丘学園 学生証</div>
        <img src="" id="prevLogo" class="logo-img" style="display:none;">
      </div>
      <div class="card-body">
        <div class="photo-frame">
          <img src="" id="prevPhoto" style="display:none;">
        </div>
        <div>
          <div class="info-basic">
            <div class="name" id="prevName">萩枝 美琳（はぎえだ みりん）</div>
            <div id="prevGradeLine" style="display:none;">学年：<span id="prevGrade"></span></div>
            <div id="prevIdLine" style="display:none;">学籍番号：<span id="prevStudentId"></span></div>
            <div>性別：<span id="prevGender">女</span></div>
            <div>誕生日：<span id="prevBirthday">3月20日</span></div>
            <div>血液型：<span id="prevBlood">A型</span></div>
            <div>MBTI：<span id="prevMbti">ENFP</span></div>
            <div>出身地：<span id="prevFrom">お菓子の国</span></div>
          </div>
          <div class="extra-info">
            <div>性格：<span id="prevPersonality">甘えん坊でいたずら好き</span></div>
            <div>モチーフ：<span id="prevMotif">黒猫</span></div>
            <div>好き：<span id="prevLike">甘いお菓子・お昼寝・かまってくれる人</span></div>
            <div>苦手：<span id="prevHate">寂しさ・早起き</span></div>
          </div>
          <div class="oneline" id="prevOneline">えへへ♡かまってくれなきゃイタズラしちゃうぞ〜</div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    <p><a href="https://mofu-mitsu.github.io/">← もふみつ工房 TOPに戻る</a></p>
  </div>
</div>

<script>
  function preview(file, target) {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      document.getElementById(target).src = e.target.result;
      document.getElementById(target).style.display = 'block';
    };
    reader.readAsDataURL(file);
  }

  document.getElementById('photo').addEventListener('change', e => preview(e.target.files[0], 'prevPhoto'));
  document.getElementById('logo').addEventListener('change', e => preview(e.target.files[0], 'prevLogo'));

  function update() {
    document.getElementById('prevSchool').innerHTML = (document.getElementById('school').value || '〇〇学園') + ' 学生証';
    document.getElementById('prevName').textContent = document.getElementById('name').value || '名前';
    document.getElementById('prevGender').textContent = document.getElementById('gender').value || '-';
    document.getElementById('prevBirthday').textContent = document.getElementById('birthday').value || '-';
    document.getElementById('prevBlood').textContent = document.getElementById('blood').value || '-';
    document.getElementById('prevMbti').textContent = document.getElementById('mbti').value || '-';
    document.getElementById('prevFrom').textContent = document.getElementById('from').value || '-';
    document.getElementById('prevPersonality').textContent = document.getElementById('personality').value || '-';
    document.getElementById('prevMotif').textContent = document.getElementById('motif').value || '-';
    document.getElementById('prevLike').textContent = document.getElementById('like').value || '-';
    document.getElementById('prevHate').textContent = document.getElementById('hate').value || '-';
    document.getElementById('prevOneline').textContent = document.getElementById('oneline').value || 'ひとこと';

    // 学年・学籍番号は空なら非表示
    const grade = document.getElementById('grade').value.trim();
    const gradeLine = document.getElementById('prevGradeLine');
    if (grade) {
      document.getElementById('prevGrade').textContent = grade;
      gradeLine.style.display = 'block';
    } else {
      gradeLine.style.display = 'none';
    }

    const id = document.getElementById('studentId').value.trim();
    const idLine = document.getElementById('prevIdLine');
    if (id) {
      document.getElementById('prevStudentId').textContent = id;
      idLine.style.display = 'block';
    } else {
      idLine.style.display = 'none';
    }
  }

  function save() {
    html2canvas(document.getElementById('card'), {
      scale: 3,
      useCORS: true,
      backgroundColor: null
    }).then(canvas => {
      const link = document.createElement('a');
      link.download = 'studentcard_' + (document.getElementById('name').value.replace(/[^a-zA-Z0-9]/g,'') || 'oshi') + '.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });
  }

  function share(platform) {
    const url = 'https://mofu-mitsu.github.io/studentcard-maker/';
    const text = '♡キャラ学生証ファクトリーで作ったよ！見て〜♡';
    if (platform === 'line') {
      window.open(`https://line.me/R/msg/text/?${encodeURIComponent(text + '\n' + url)}`);
    } else if (platform === 'x') {
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`);
    }
  }

  // 初期化
  update();
</script>

</body>
</html>