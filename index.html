<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>♡キャラ学生証ファクトリー♡</title>
  <link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root {
      --main: #ff69b4;
      --text: #6B4F3A;
      --bg: #fffaf0;
      --grid: url('https://www.transparenttextures.com/patterns/graphy.png');
      --border: #d8c4a8;
      --photo-bg: #e6f2ff;
      --dash: #b38b67;
    }
    body {margin:0;padding:20px 0;min-height:100vh;font-family:'Kiwi Maru',sans-serif;background:linear-gradient(#fff0f8,#ffe4f0);}
    .container {max-width:1100px;margin:0 auto;}
    .header {background:linear-gradient(90deg,#ffb3d9,#ff69b4);color:white;text-align:center;padding:25px;font-size:28px;font-weight:bold;border-radius:20px 20px 0 0;}
    .main {padding:30px;display:grid;grid-template-columns:1fr 620px;gap:40px;}
    @media(max-width:900px){.main{grid-template-columns:1fr;}}
    .form-area {background:#fffafa;padding:28px;border-radius:20px;border:3px dashed #ffd1dc;}
    label {display:block;margin:16px 0 6px;font-weight:bold;color:#b36c84;}
    input,textarea,select {width:100%;padding:12px;border:2px solid #ffd1dc;border-radius:10px;box-sizing:border-box;}
    input[type="file"]{display:none;}
    .file-btn {display:inline-block;background:var(--main);color:white;padding:12px 28px;border-radius:30px;cursor:pointer;font-weight:bold;box-shadow:0 4px 10px rgba(255,105,180,0.3);}
    button {background:var(--main);color:white;border:none;padding:12px 20px;border-radius:30px;font-weight:bold;cursor:pointer;margin:8px 4px 0 0;}

    #card {
      width:620px;height:380px;
      background:var(--bg) var(--grid) repeat;
      background-size:28px 28px;
      border-radius:24px;padding:26px;
      box-shadow:0 15px 35px rgba(0,0,0,0.22);
      position:relative;color:var(--text);font-size:15px;line-height:1.5;overflow:hidden;
    }
    #card::before {content:"";position:absolute;inset:0;background:var(--bg);opacity:0.94;}
    .content {position:relative;z-index:1;height:100%;display:flex;flex-direction:column;}

    .top-bar {display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:15px;margin-bottom:10px;}
    .school-title {font-size:25px;font-weight:bold;}
    .name-area {text-align:center;}
    .name {font-size:34px!important;font-weight:bold;display:block;}
    .sub-right {text-align:right;font-size:16px;line-height:1.4;}
    .logo-img {width:62px;height:62px;object-fit:contain;}

    .middle {display:grid;grid-template-columns:220px 1fr;gap:26px;flex:1;}
    .photo-area {width:220px;height:220px;background:var(--photo-bg);border:10px solid var(--border);border-radius:18px;overflow:hidden;box-shadow:0 6px 15px rgba(0,0,0,0.15);}
    .photo-area img {width:100%;height:100%;object-fit:cover;}

    .info-grid {display:grid;gap:10px 20px;align-content:start;font-size:15px;}
    .info-item {white-space:nowrap;}

    .oneline-bar {margin-top:16px;padding:16px 22px;background:rgba(255,255,255,0.85);border:3px dashed var(--dash);border-radius:16px;text-align:center;font-style:italic;font-size:17px;}
  </style>
</head>
<body>

<div class="container">
  <div class="header">♡ キャラ学生証ファクトリー ♡</div>
  
  <div class="main">
    <div class="form-area">
      <label>学校名</label><input type="text" id="school" placeholder="例：とりの丘学園">
      <label>名前（ふりがなも可）</label><input type="text" id="name" placeholder="例：萩枝 美琳（はぎえだ みりん）">
      <label>名前の色</label>
      <select id="nameColor">
        <option value="#d14a8a">ピンク（女の子向け）</option>
        <option value="#4169e1">青（男の子向け）</option>
        <option value="#8b4513">茶色（中性的）</option>
      </select>

      <label>性別（任意）</label><input type="text" id="gender">
      <label>モチーフ（任意）</label><input type="text" id="motif">

      <label>学年・クラス（任意）</label><input type="text" id="grade">
      <label>学籍番号／ID（任意）</label><input type="text" id="studentId">
      <label>性格（任意）</label><input type="text" id="personality">
      <label>容姿（任意）</label><input type="text" id="appearance">
      <label>誕生日（任意）</label><input type="text" id="birthday">
      <label>血液型（任意）</label><input type="text" id="blood">
      <label>出身地（任意）</label><input type="text" id="from">
      <label>MBTI（任意）</label><input type="text" id="mbti">
      <label>その他（任意）</label><input type="text" id="other">
      <label>好きなもの（任意）</label><input type="text" id="like">
      <label>苦手なもの（任意）</label><input type="text" id="hate">

      <label>ひとこと（任意）</label><textarea id="oneline" rows="2" placeholder="えへへ♡かまってくれなきゃイタズラしちゃうぞ〜"></textarea>

      <label>顔写真アップロード</label>
      <label class="file-btn">♡ キャラ画像を選ぶ ♡<input type="file" id="photo" accept="image/*"></label>
      <label>右上ロゴ画像（任意）</label>
      <label class="file-btn">♡ ロゴ画像を選ぶ ♡<input type="file" id="logo" accept="image/*"></label>

      <div style="margin-top:25px;">
        <button onclick="update()">プレビュー更新</button>
        <button onclick="save()">画像保存♡</button>
        <button onclick="nativeShare()">共有する</button>
      </div>
    </div>

    <div style="display:flex;justify-content:center;align-items:flex-start;">
      <div id="card">
        <div class="content">
          <div class="top-bar">
            <div class="school-title" id="prevSchool">学生証</div>
            <div class="name-area"><div class="name" id="prevName">-</div></div>
            <div class="sub-right">
              <div id="prevGenderLine">性別：<span id="prevGender">-</span></div>
              <div id="prevMotifLine">モチーフ：<span id="prevMotif">-</span></div>
            </div>
            <img src="" id="prevLogo" class="logo-img" style="display:none;">
          </div>

          <div class="middle">
            <div class="photo-area"><img src="" id="prevPhoto" style="display:none;"></div>
            <div class="info-grid" id="infoGrid"></div>
          </div>

          <div class="oneline-bar" id="prevOneline">－</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function preview(file,target){if(!file)return;const r=new FileReader();r.onload=e=>{document.getElementById(target).src=e.target.result;document.getElementById(target).style.display='block';};r.readAsDataURL(file);}
  document.getElementById('photo').addEventListener('change',e=>preview(e.target.files[0],'prevPhoto'));
  document.getElementById('logo').addEventListener('change',e=>preview(e.target.files[0],'prevLogo'));

  function update(){
    document.getElementById('prevSchool').textContent=(document.getElementById('school').value.trim()||'')+' 学生証'||'学生証';
    const name=document.getElementById('name').value.trim()||'-';
    const nameEl=document.getElementById('prevName');
    nameEl.textContent=name;
    nameEl.style.color=document.getElementById('nameColor').value;

    const gender=document.getElementById('gender').value.trim();
    document.getElementById('prevGenderLine').style.display=gender?'block':'none';
    document.getElementById('prevGender').textContent=gender||'-';

    const motif=document.getElementById('motif').value.trim();
    document.getElementById('prevMotifLine').style.display=motif?'block':'none';
    document.getElementById('prevMotif').textContent=motif||'-';

    const grid=document.getElementById('infoGrid');
    grid.innerHTML='';

    const items=[
      'grade','studentId','personality','appearance','birthday','blood','from','mbti','other','like','hate'
    ];
    items.forEach(id=>{
      const val=document.getElementById(id).value.trim();
      if(val){
        const label=document.querySelector(`label[for="${id}"]`).textContent.replace(/（任意）|／ID/g,'');
        const div=document.createElement('div');
        div.className='info-item';
        div.textContent=`${label}：${val}`;
        grid.appendChild(div);
      }
    });

    document.getElementById('prevOneline').textContent=document.getElementById('oneline').value.trim()||'－';
  }

  function save(){
    html2canvas(document.getElementById('card'),{scale:3,useCORS:true,backgroundColor:null}).then(c=>{
      const a=document.createElement('a');a.download='studentcard.png';a.href=c.toDataURL();a.click();
    });
  }

  function nativeShare(){
    if(navigator.share){navigator.share({title:'キャラ学生証作ったよ♡',url:location.href});}
    else{alert('共有できないよ〜');}
  }

  update();
</script>
</body>
</html>